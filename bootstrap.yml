---
- hosts: localhost
  vars:
    gotroot: '{{ ansible_effective_user_id == 0 }}'
  tasks:
    # TODO support not only Fedora
    - include_vars: 'vars.{{ ansible_distribution | lower }}.yml'
    - block:
      - include_tasks: 'tasks.{{ ansible_distribution | lower }}.yml'
      - package:
          name: '{{ repopkgs }}'
      - package:
          name: '{{ pkgs }}'
          enablerepo: '{{ repos2enable | default(omit) }}'
      - yum_repository:
          name: '{{ item.name }}'
          description: '{{ item.description | default(item.name) }}'
          baseurl: '{{ item.baseurl | default(omit) }}'
          metalink: '{{ item.metalink | default(omit) }}'
          mirrorlist: '{{ item.mirrorlist | default(omit) }}'
          gpgcheck: '{{ item.gpgkey is defined }}'
          gpgkey: '{{ item.gpgkey | default(omit) }}'
        loop: '{{ extrarepos | default([]) }}'
      - package:
          name: '{{ extrapkgs | default([]) }}'
      become: '{{ not gotroot }}'
